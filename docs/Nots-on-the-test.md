# Gold Coffee Sales Application Documentation

## Table of Contents

1. [Project Overview](#project-overview)
2. [Setup & Installation](#setup--installation)
3. [Configuration](#configuration)
4. [Database](#database)

   * [Migrations](#migrations)
   * [Seeders](#seeders)
   * [Factory](#factory)
5. [Models & Relationships](#models--relationships)
6. [Controllers](#controllers)
7. [Routes](#routes)
8. [Views](#views)
9. [Service Provider Enhancements](#service-provider-enhancements)
10. [Testing](#testing)
11. [Git Workflow](#git-workflow)

---

## Project Overview

This Laravel application provides a quick gold-coffee selling price calculator and sales recording functionality. Customer service inputs the quantity of coffee bags and unit cost; the system calculates the total cost and selling price with a 25% profit margin plus a £10 shipping cost, then records the sale.

---

## Setup & Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/Cyber-Duck/laravel-test.git
   cd laravel-test
   ```
2. Install PHP dependencies:

   ```bash
   composer install
   ```
3. Copy environment file and generate application key:

   ```bash
   cp .env.example .env
   php artisan key:generate
   ```
4. (Optional) Use Laravel Sail for containerized setup:

   ```bash
   ./vendor/bin/sail up -d
   ```
5. Run migrations and seeders:

   ```bash
   php artisan migrate --seed
   ```
6. Serve the application:

   ```bash
   php artisan serve
   ```

---

## Configuration

* **`config/coffee.php`**

  ```php
  return [
      'profit_margin' => 0.25,   // 25% profit
      'shipping_cost' => 10.00,  // £10 shipping
  ];
  ```

---

## Database

### Migrations

* **`create_sales_table`** migration creates the `sales` table with columns:

  * `id`, `user_id`, `quantity`, `unit_cost`, `cost`, `selling_price`, timestamps.

### Seeders

* **`DatabaseSeeder`** seeds:

  1. A `Sales Agent` user with email `sales@coffee.shop` and password `Password123`.
  2. Ten sample `Sale` records linked to the agent.

### Factory

* **`SaleFactory`** generates realistic dummy sales:

  * Random `quantity` (1–20) and `unit_cost` (2.00–15.00).
  * Computes `cost` and `selling_price` using the same formula as the controller.

---

## Models & Relationships

* **`User`** model:

  ```php
  public function sales()
  {
      return $this->hasMany(Sale::class);
  }
  ```

* **`Sale`** model:

  ```php
  protected $fillable = ['user_id','quantity','unit_cost','cost','selling_price'];

  public function user()
  {
      return $this->belongsTo(User::class);
  }
  ```

---

## Controllers

* **`SaleController`** (resource-style, but only `create` & `store` used):

  * `create()`: loads the sales form and previous sales for the authenticated user.
  * `store()`: validates input, calculates cost & selling price, saves a new `Sale`, then redisplays the form with results.

---

## Routes

Defined in **`routes/web.php`**, protected by `auth` middleware:

```php
Route::middleware('auth')->group(function () {
    Route::get('/sales', [SaleController::class,'create'])->name('sales.create');
    Route::post('/sales',[SaleController::class,'store'])->name('sales.store');
    Route::get('/shipping-partners', fn() => view('shipping_partners'))->name('shipping.partners');
});
Route::get('/', fn() => redirect()->route('login'));
require __DIR__.'/auth.php';
```

---

## Views

* **`resources/views/sales/create.blade.php`**

  * Responsive Tailwind form with inputs for **Quantity**, **Unit Cost**, and readonly **Selling Price**.
  * “Record Sale” button.
  * Table of previous sales, formatted with alternating row backgrounds.

---

## Service Provider Enhancements

* **`App\Providers\AppServiceProvider`** registers a custom Blade directive `@money($amount)` to prefix and format currency values consistently across views.

---

## Testing

* **`SalesPageTest`** in `tests/Feature` verifies:

  * Authenticated user can access the sales page.
  * Previous sales seeded via factory appear in the view.
  * The `sales.create` route is defined and returns status 200.

Run all tests with:

```bash
php artisan test
```

---

## Git Workflow

* Branch-per-feature approach:

  1. `part-1-setup`: environment & seeding.
  2. `part-1-form-view`: Blade form & route.
  3. `part-1-calculation`: validation & calculation logic.
  4. `part-1-result`: result display & persistence.
  5. `part-1-testing`: feature tests.
* Commits are descriptive and frequent, e.g.:

  * `feat(sales): implement Gold coffee selling price calculation and sale recording (shipping pending)`
  * `test(sales): add SalesPageTest to verify sales.create route and previous sales display`

---

*Documentation generated by Murat on May 12, 2025.*
